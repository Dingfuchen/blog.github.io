# ELK配置
---
## 1、配置elasticsearch
从官网下载tar包（5.0.1），解压到服务器（已安装jdk1.8,并配置到环境变量中）。修改/elasticsearch-5.0.1/config/elasticsearch.yml中一下几个属性值（反注释的几个属性）。 

	network.host: 127.0.0.1
	#
	# Set a custom port for HTTP:
	#
	http.port: 8089

启动elasticsearch  
<pre>
nohup ./elasticsearch&
</pre>
## 2、配置kibana
从官网下载tar包（5.0.1），解压到服务器（已安装jdk1.8,并配置到环境变量中）。修改/kibana-5.0.0-linux-x86_64/config/kibana.yml中一下几个属性值（反注释的几个属性）。
<pre>
server.port: 8090
	
# Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.
# The default is 'localhost', which usually means remote machines will not be able to connect.
# To allow connections from remote users, set this parameter to a non-loopback address.
server.host: "0.0.0.0"

# Enables you to specify a path to mount Kibana at if you are running behind a proxy. This only affects
# the URLs generated by Kibana, your proxy is expected to remove the basePath value before forwarding requests
# to Kibana. This setting cannot end in a slash.
#server.basePath: ""

# The maximum payload size in bytes for incoming server requests.
#server.maxPayloadBytes: 1048576

# The Kibana server's name.  This is used for display purposes.
#server.name: "your-hostname"

# The URL of the Elasticsearch instance to use for all your queries.
elasticsearch.url: "http://127.0.0.1:8089"
</pre>
启动kibana  
<pre>
nohup ./kibana&
</pre>
## 3、配置logstash
从官网下载tar包（logstash-5.0.0），解压到服务器。在/logstash-5.0.0/config修改新建logstash.conf文件。内容如下：  
<pre>
input {
   redis {
        #从redis里取出日志
        host => '10.240.40.122'
        data_type => 'list'
        port => "6379"
        key => 'queue:elk:redis'
        type => 'template'
        codec => plain {
                charset => "UTF-8"
        }
   }
}

filter {
  grok {
        match => {"message" => "\s*\[%{IP:client_ip}\]\s*\[%{USERNAME:username}\]\s*\[%{LOGLEVEL:log_level}\]\s*\[(?<trans_code>([\s\S]*))\]\s*\[(?<serial_no>([\s\S]*))\]\s*\[%{JAVAFILE:java_file}\:%{NUMBER:line_number}\]\s*\[%{TIMESTAMP_ISO8601:time}\]\s*(?<info>([\s\S]*))"}
}        
          
}        
        
 
output {     
  elasticsearch {
    hosts => ["127.0.0.1:8089"]
    action => "index"
    codec => rubydebug
    index => "%{type}-%{+YYYY.MM.dd}"
    template_name => "%{type}"
  } 
  stdout { codec => rubydebug } 
}   
</pre>
启动logstash，以下命令为自动刷新日志。
<pre>
bin/logstash -f /prmsce/elk/logstash-5.0.0/config/logstash.conf --config.reload.automatic&
</pre>